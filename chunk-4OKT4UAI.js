import{a as ot}from"./chunk-L4SYHPID.js";import{m as q,o as V,q as j,r as z,s as U,t as _}from"./chunk-4OLG6RPQ.js";import{a as W}from"./chunk-4PWJQAOC.js";import{l as h,m as C,p as tt,q as et,v as x,w,y as D,z as E}from"./chunk-AYN2OAEG.js";import{E as M,G as N,I as b,J as H,K as J,M as k,N as K,O as Q,P as X,Q as Y,S as Z,T as $}from"./chunk-KU5NV46G.js";import{Aa as f,Fa as S,Ja as p,Lb as G,P as g,Pb as A,Sa as o,Ta as t,Ua as I,Za as d,_b as B,d as L,ib as i,m as T,nb as F,ob as P,pb as O,qa as s,va as R}from"./chunk-CZGCKYO5.js";var v=class a{constructor(r){this.dialogRef=r}dni="";nombreCompleto="";aceptar(){this.dialogRef.close({dni:this.dni,nombreCompleto:this.nombreCompleto})}cancelar(){this.dialogRef.close(null)}static \u0275fac=function(n){return new(n||a)(R(q))};static \u0275cmp=f({type:a,selectors:[["app-dni-dialog"]],decls:16,vars:2,consts:[["mat-dialog-title",""],["appearance","fill"],["matInput","","placeholder","Nombre completo",3,"ngModelChange","ngModel"],["matInput","","placeholder","12345678A",3,"ngModelChange","ngModel"],["align","end"],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"click"]],template:function(n,e){n&1&&(o(0,"h2",0),i(1,"Completa tu registro"),t(),o(2,"mat-dialog-content")(3,"p"),i(4,"Introduce tu nombre completo:"),t(),o(5,"mat-form-field",1)(6,"input",2),O("ngModelChange",function(l){return P(e.nombreCompleto,l)||(e.nombreCompleto=l),l}),t()(),o(7,"p"),i(8,"Introduce tu DNI:"),t(),o(9,"mat-form-field",1)(10,"input",3),O("ngModelChange",function(l){return P(e.dni,l)||(e.dni=l),l}),t()()(),o(11,"mat-dialog-actions",4)(12,"button",5),d("click",function(){return e.cancelar()}),i(13,"Cancelar"),t(),o(14,"button",6),d("click",function(){return e.aceptar()}),i(15,"Aceptar"),t()()),n&2&&(s(6),F("ngModel",e.nombreCompleto),s(4),F("ngModel",e.dni))},dependencies:[_,j,U,z,w,x,E,D,C,h,Z,M,b,K],styles:["h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:28px;color:#0086b3;font-weight:700;margin-bottom:15px;text-align:center}mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px}mat-dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:22px;color:#333;text-align:center;margin:0;font-family:Arial,sans-serif;line-height:1.5}mat-form-field[_ngcontent-%COMP%]{width:250px}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;width:100%;margin-top:20px;gap:12px;text-align:center}button[mat-button][_ngcontent-%COMP%]{background-color:#0086b3;color:#fff;border-radius:5px;padding:8px 20px;font-weight:700;transition:background-color .3s ease}button[mat-button][_ngcontent-%COMP%]:hover{background-color:#007399}.mat-dialog-container[_ngcontent-%COMP%]{background-color:#f5f5f5;border-radius:8px;box-shadow:0 4px 12px #0000001a;padding:20px;width:350px;display:flex;flex-direction:column;align-items:center}"]})};function pt(a,r){a&1&&(o(0,"mat-error"),i(1,"Correo electr\xF3nico es requerido"),t())}function dt(a,r){a&1&&(o(0,"mat-error"),i(1,"Correo electr\xF3nico no es v\xE1lido"),t())}function ut(a,r){a&1&&(o(0,"mat-error"),i(1,"Contrase\xF1a es requerida"),t())}function gt(a,r){a&1&&(o(0,"mat-error"),i(1,"Debe tener al menos 8 caracteres"),t())}var nt=class a{authService=g(W);router=g(B);dialog=g(V);form=new J({email:new k("",[N.required]),password:new k("",[N.required])});onSubmit(){this.form.valid&&this.authService.login(this.form.value).then(()=>{this.router.navigate(["/inicio"])}).catch(r=>{this.showErrorPopup(this.getErrorMessage(r.code))})}getErrorMessage(r){switch(r){case"auth/user-not-found":return"No se encontr\xF3 una cuenta con ese correo electr\xF3nico.";case"auth/wrong-password":return"La contrase\xF1a es incorrecta.";case"auth/invalid-email":return"El correo electr\xF3nico no es v\xE1lido.";default:return"Ocurri\xF3 un error inesperado. Int\xE9ntalo de nuevo."}}onClickGoogle(){return L(this,null,function*(){try{let n=(yield this.authService.loginWithGoogleOnly()).user,e=n.email,m=n.uid;if(!(yield this.authService.userExistsInFirestore(e))){let u=this.dialog.open(v),c=yield T(u.afterClosed());if(!c||!c.dni||!c.nombreCompleto){this.showErrorPopup("Datos inv\xE1lidos o cancelados por el usuario."),yield n.delete();return}let{dni:y,nombreCompleto:it}=c;if(!this.authService.validateDniLetter(y)){this.showErrorPopup("DNI inv\xE1lido."),yield n.delete();return}if(yield this.authService.dniExistsInFirestore(y)){this.showErrorPopup("Este DNI ya est\xE1 registrado con otra cuenta."),yield n.delete();return}yield this.authService.saveUserData(m,e,y,it)}}catch{this.showErrorPopup("Error al iniciar sesi\xF3n con Google.")}})}showErrorPopup(r){let n=this.dialog.open(ot);n.componentInstance.message=r}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=f({type:a,selectors:[["app-login"]],decls:23,vars:6,consts:[[1,"login-container"],[1,"login-form",3,"ngSubmit","formGroup"],["appearance","fill"],["matInput","","type","email","formControlName","email","placeholder","Introduce tu correo electr\xF3nico"],[4,"ngIf"],["matInput","","type","password","formControlName","password","placeholder","Introduce tu contrase\xF1a"],[1,"login-actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-button","","color","accent","type","button",3,"click"],["href","/register"]],template:function(n,e){if(n&1&&(o(0,"div",0)(1,"h2"),i(2,"Inicia Sesi\xF3n"),t(),o(3,"form",1),d("ngSubmit",function(){return e.onSubmit()}),o(4,"mat-form-field",2)(5,"mat-label"),i(6,"Correo electr\xF3nico"),t(),I(7,"input",3),S(8,pt,2,0,"mat-error",4)(9,dt,2,0,"mat-error",4),t(),o(10,"mat-form-field",2)(11,"mat-label"),i(12,"Contrase\xF1a"),t(),I(13,"input",5),S(14,ut,2,0,"mat-error",4)(15,gt,2,0,"mat-error",4),t(),o(16,"div",6)(17,"button",7),i(18,"Inicia sesi\xF3n"),t(),o(19,"button",8),d("click",function(){return e.onClickGoogle()}),i(20,"Inicia sesi\xF3n con Google"),t(),o(21,"a",9),i(22,"\xBFNo tienes cuenta? Reg\xEDstrate"),t()()()()),n&2){let m,l,u,c;s(3),p("formGroup",e.form),s(5),p("ngIf",(m=e.form.get("email"))==null?null:m.hasError("required")),s(),p("ngIf",(l=e.form.get("email"))==null?null:l.hasError("email")),s(5),p("ngIf",(u=e.form.get("password"))==null?null:u.hasError("required")),s(),p("ngIf",(c=e.form.get("password"))==null?null:c.hasError("minlength")),s(2),p("disabled",e.form.invalid)}},dependencies:[$,Q,M,b,H,X,Y,w,x,tt,et,E,D,C,h,A,G,_],styles:[".login-container[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 10px #0000001a;text-align:center;width:350px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.login-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#0086b3;margin-bottom:1rem}mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}button[mat-raised-button][_ngcontent-%COMP%]{width:100%;padding:.8rem;font-size:1rem;border-radius:8px}button[mat-button][_ngcontent-%COMP%]{width:100%;margin-top:.5rem;text-transform:none;font-weight:700}.login-actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;margin-top:1rem;color:#0086b3;text-decoration:none}.login-actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.google-logo[_ngcontent-%COMP%]{width:20px;height:20px;margin-right:8px;vertical-align:middle}"]})};export{nt as LoginComponent};
