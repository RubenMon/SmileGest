import './polyfills.server.mjs';
import{a as j}from"./chunk-N4CGARFT.mjs";import{o as N,t as D}from"./chunk-6TPDTLXY.mjs";import{a as y}from"./chunk-BCCA7UYA.mjs";import{l as S,m as F,p as G,q as z,v as B,w as V,y as Z,z as $}from"./chunk-OJHNC5O3.mjs";import{E as P,G as s,I as R,J as O,K as q,M as g,O as A,P as L,Q as T,T as k}from"./chunk-M5VIGCBW.mjs";import{Da as E,Dc as w,Ia as p,L as C,Pa as u,Ya as n,Za as r,_a as d,db as x,eb as c,fc as M,jc as I,ob as a,qb as f,ta as l}from"./chunk-V3KWYR2Y.mjs";import{h as v}from"./chunk-S6KH3LOX.mjs";function H(o,i){if(o&1&&(n(0,"mat-error"),a(1),r()),o&2){let t,e=c();l(),f(" ",(t=e.form.get("nombreCompleto"))!=null&&t.hasError("required")?"El nombre es obligatorio":"Nombre inv\xE1lido"," ")}}function J(o,i){if(o&1&&(n(0,"mat-error"),a(1),r()),o&2){let t,e=c();l(),f(" ",(t=e.form.get("dni"))!=null&&t.hasError("required")?"El DNI es obligatorio":"DNI inv\xE1lido"," ")}}function K(o,i){if(o&1&&(n(0,"mat-error"),a(1),r()),o&2){let t,e=c();l(),f(" ",(t=e.form.get("email"))!=null&&t.hasError("required")?"El correo es obligatorio":"Correo inv\xE1lido"," ")}}function Q(o,i){if(o&1&&(n(0,"mat-error"),a(1),r()),o&2){let t,e=c();l(),f(" ",(t=e.form.get("password"))!=null&&t.hasError("required")?"La contrase\xF1a es obligatoria":"Debe tener al menos 8 caracteres, una letra may\xFAscula, una letra min\xFAscula y un n\xFAmero"," ")}}var Y=class o{authService=C(y);router=C(w);dialog=C(N);form=new q({nombreCompleto:new g("",[s.required,s.pattern(/^[\p{L}][\p{L}\p{M}\p{Zs}'-]{1,100}$/u)]),email:new g("",[s.required,s.email]),password:new g("",[s.required,s.minLength(8),s.pattern("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)[A-Za-z\\d]+$")]),dni:new g("",[s.required])});onSubmit(){return v(this,null,function*(){let{dni:i,nombreCompleto:t}=this.form.value;if(!this.authService.validateDniLetter(i)){this.showErrorPopup("El DNI introducido no es v\xE1lido.");return}let e;try{e=yield this.authService.dniExistsInFirestore(i)}catch(m){console.error("fallo dniExistsInFirestore:",m),this.showErrorPopup("Ocurri\xF3 un error al verificar el DNI.");return}if(e){this.showErrorPopup("Este DNI ya est\xE1 registrado con otra cuenta.");return}if(this.form.valid)try{yield this.authService.register(this.form.value),this.router.navigate(["/login"])}catch(m){this.showErrorPopup(this.getErrorMessage(m.code))}})}getErrorMessage(i){switch(i){case"auth/email-already-in-use":return"El correo ya est\xE1 registrado.";case"auth/invalid-email":return"El correo no es v\xE1lido.";case"auth/weak-password":return"La contrase\xF1a es demasiado d\xE9bil.";default:return"Ocurri\xF3 un error inesperado. Int\xE9ntalo de nuevo."}}showErrorPopup(i){let t=this.dialog.open(j);t.componentInstance.message=i}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=E({type:o,selectors:[["app-register"]],decls:28,vars:6,consts:[[1,"register-container"],[3,"ngSubmit","formGroup"],["appearance","fill"],["matInput","","placeholder","Nombre completo","type","text","formControlName","nombreCompleto"],[4,"ngIf"],["matInput","","placeholder","DNI","type","text","formControlName","dni"],["matInput","","placeholder","Correo electr\xF3nico","type","email","formControlName","email"],["matInput","","placeholder","Contrase\xF1a","type","password","formControlName","password"],["mat-flat-button","","type","submit",3,"disabled"],["href","/login"]],template:function(t,e){if(t&1&&(n(0,"div",0)(1,"h2"),a(2,"Registro"),r(),n(3,"form",1),x("ngSubmit",function(){return e.onSubmit()}),n(4,"mat-form-field",2)(5,"mat-label"),a(6,"Nombre completo"),r(),d(7,"input",3),p(8,H,2,1,"mat-error",4),r(),n(9,"mat-form-field",2)(10,"mat-label"),a(11,"DNI"),r(),d(12,"input",5),p(13,J,2,1,"mat-error",4),r(),n(14,"mat-form-field",2)(15,"mat-label"),a(16,"Correo electr\xF3nico"),r(),d(17,"input",6),p(18,K,2,1,"mat-error",4),r(),n(19,"mat-form-field",2)(20,"mat-label"),a(21,"Contrase\xF1a"),r(),d(22,"input",7),p(23,Q,2,1,"mat-error",4),r(),n(24,"button",8),a(25," Registrarse "),r(),n(26,"a",9),a(27,"\xBFYa tienes cuenta? Inicia sesi\xF3n"),r()()()),t&2){let m,h,b,_;l(3),u("formGroup",e.form),l(5),u("ngIf",((m=e.form.get("nombreCompleto"))==null?null:m.invalid)&&((m=e.form.get("nombreCompleto"))==null?null:m.touched)),l(5),u("ngIf",((h=e.form.get("dni"))==null?null:h.invalid)&&((h=e.form.get("dni"))==null?null:h.touched)),l(5),u("ngIf",((b=e.form.get("email"))==null?null:b.invalid)&&((b=e.form.get("email"))==null?null:b.touched)),l(5),u("ngIf",((_=e.form.get("password"))==null?null:_.invalid)&&((_=e.form.get("password"))==null?null:_.touched)),l(),u("disabled",e.form.invalid)}},dependencies:[k,A,P,R,O,L,T,V,B,G,z,$,Z,F,S,I,M,D],styles:[".register-container[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 10px #0000001a;text-align:center;width:350px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.register-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#0086b3;margin-bottom:1rem}mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}button[mat-flat-button][_ngcontent-%COMP%]{width:100%;padding:.8rem;font-size:1rem;border-radius:8px;background-color:#0086b3;color:#fff}button[mat-flat-button][_ngcontent-%COMP%]:hover{background-color:#006f91}.register-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;margin-top:1rem;color:#0086b3;text-decoration:none}.register-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};export{Y as RegisterComponent};
