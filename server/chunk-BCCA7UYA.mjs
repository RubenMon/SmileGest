import './polyfills.server.mjs';
import{H as p,Hc as g,Ic as d,Jc as f,Kc as E,L as o,Mc as v,Nc as y,Rc as a,Sc as l,Uc as u,Vc as c,Wc as h,Xc as m,Yc as b}from"./chunk-V3KWYR2Y.mjs";import{h as n}from"./chunk-S6KH3LOX.mjs";var C=class i{auth=o(y);firestore=o(b);currentEmail=null;constructor(){}setCurrentEmail(t){this.currentEmail=t}getCurrentEmail(){return this.auth.currentUser?.email||null}register(t){return d(this.auth,t.email,t.password).then(e=>{this.setCurrentEmail(t.email);let r=e.user.uid,s=l(this.firestore,"users",r);return m(s,{email:t.email,dni:t.dni,nombreCompleto:t.nombreCompleto})})}login(t){return f(this.auth,t.email,t.password).then(e=>(this.setCurrentEmail(e.user.email),e))}loginWithGoogleOnly(){let t=new g;return v(this.auth,t).then(e=>(this.setCurrentEmail(e.user.email),e))}userExistsInFirestore(t){return n(this,null,function*(){let e=u(a(this.firestore,"users"),c("email","==",t));return!(yield h(e)).empty})}dniExistsInFirestore(t){return n(this,null,function*(){let e=u(a(this.firestore,"users"),c("dni","==",t));return!(yield h(e)).empty})}saveUserData(t,e,r,s){return n(this,null,function*(){let w=l(this.firestore,"users",t);return m(w,{email:e,dni:r,nombreCompleto:s})})}logout(){return E(this.auth).then(()=>{this.setCurrentEmail(null)})}isAuthenticated(){return this.auth.currentUser!==null}validateDniLetter(t){if(!t||!/^\d{8}[A-Za-z]$/.test(t))return!1;let e=parseInt(t.substring(0,8),10);return t.charAt(8).toUpperCase()==="TRWAGMYFPDXBNJZSQVHLCKE".charAt(e%23)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{C as a};
